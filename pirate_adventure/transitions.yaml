---
conditions:

  ?
    - @turns == 0
  :
    - begin

  ?
    - @player.hp < 1
  :
    - death

  ?
    - @state['entered_neverneverland']
  :
    - neverneverland

  ?
    - (@turns % 8) < 4
  :
    - tide_in

  ?
    - (@turns % 8) >= 4
  :
    - tide_out

  ?
    - @props['rum'].location == 'pirate' and !@props['bottle'].location
  :
    - pirate_runs_off

  ?
    - @props['bottles'].location == 'shore' && @props['bottles'].location == 'shore' && @props['bottles'].traits['buried'] == false
  :
    - pirate_grabs_rum

  ?
    - @characters['parrot'].location == 'monastery' && @characters['snakes'].location == 'monastery'
  :
    - snakes_run_off

outcomes:

  begin: |
    @state['ship_location'] = 'beach'
    "" # don't return any output for this

  death: |
    @over = true
    "You have died.\nWould you like to restart? (y/n)"

  neverneverland: |
    if (@state['entered_neverneverland'] + 6) < @turns
      @over = true
      "Since nothing is happening this adventure is over.\nWould you like to restart? (y/n)\n"
    end

  tide_in: |
    # sail and dig commands need to know whether tide is in or out
    @state['tide'] = 'in'

    transition_output = ''
    # even if character has shovel, prevent seeing or taking anchor while tide is in and anchor in lagoon
    if @props['anchor'].location == 'lagoon'
      @props['anchor'].traits['visible'] = false
    end
    if @player.location == 'lagoon'
      transition_output << "The tide is coming in. Flotsam and jetsam surrounds.\n"
      if @props['water wings'].location != 'player'
        transition_output << "I'm underwater, I guess I don't swim well. Blub Blub...\n"
        transition_output << eval(@transitions['outcomes']['death'])
      end
      transition_output
    end

  tide_out: |
    # sail and dig commands need to know whether tide is in or out
    @state['tide'] = 'out'

    # if anchor is in lagoon, let character see it
    if @props['anchor'].location == 'lagoon'
      @props['anchor'].traits['visible'] = true
    end
    if @player.location == 'lagoon'
      "The tide is out.\n"
    end

  pirate_runs_off: |
    @characters['pirate'].location = 'attic'
    @characters['pirate'].description = 'The pirate is sleeping.'
    @props['bottle'].location = 'attic'
    "The pirate grabs the rum and scuttles off chortling.\n"

  pirate_grabs_rum: |
    @props['bottles'].location = 'pirate'
    @characters['pirate'].location = 'graveyard'
    @characters['pirate'].description = 'The pirate is sleeping.'
    "You dug up bottles of rum!\nThe pirate grabs the rum and scuttles off chortling.\n"

  snakes_run_off: |
    @characters['snakes'].location = ''
    "Parrot attacks snakes and drives them off.\n"

  win: |
    # winning logic can be put here

  loss: |
    # losing logic can be put here
